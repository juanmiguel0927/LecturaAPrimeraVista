<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=kbffV7V9BIH3Ot2AQ2LQRA);ol{margin:0;padding:0}table td,table th{padding:0}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Courier";font-style:normal}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c2{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.title{padding-top:24pt;color:#000000;font-weight:700;font-size:36pt;padding-bottom:6pt;font-family:"Arial";line-height:1.0;page-break-after:avoid;text-align:left}.subtitle{padding-top:18pt;color:#666666;font-size:24pt;padding-bottom:4pt;font-family:"Georgia";line-height:1.0;page-break-after:avoid;font-style:italic;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:12pt;color:#000000;font-weight:700;font-size:24pt;padding-bottom:12pt;font-family:"Arial";line-height:1.0;text-align:left}h2{padding-top:11.2pt;color:#000000;font-weight:700;font-size:18pt;padding-bottom:11.2pt;font-family:"Arial";line-height:1.0;text-align:left}h3{padding-top:12pt;color:#000000;font-weight:700;font-size:14pt;padding-bottom:12pt;font-family:"Arial";line-height:1.0;text-align:left}h4{padding-top:12.8pt;color:#000000;font-weight:700;font-size:12pt;padding-bottom:12.8pt;font-family:"Arial";line-height:1.0;text-align:left}h5{padding-top:12.8pt;color:#000000;font-weight:700;font-size:9pt;padding-bottom:12.8pt;font-family:"Arial";line-height:1.0;text-align:left}h6{padding-top:18pt;color:#000000;font-weight:700;font-size:8pt;padding-bottom:18pt;font-family:"Arial";line-height:1.0;text-align:left}</style></head><body class="c2 doc-content"><p class="c1"><span class="c0">&lt;!DOCTYPE html&gt;<br>&lt;html lang=&quot;es&quot;&gt;<br>&lt;head&gt;<br> &nbsp; &nbsp;&lt;meta charset=&quot;UTF-8&quot;&gt;<br> &nbsp; &nbsp;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;<br> &nbsp; &nbsp;&lt;title&gt;Lectura a Primera Vista&lt;/title&gt;<br> &nbsp; &nbsp;&lt;!-- Tailwind CSS CDN for a mobile-first, responsive design --&gt;<br> &nbsp; &nbsp;&lt;script src=&quot;https://cdn.tailwindcss.com&quot;&gt;&lt;/script&gt;<br> &nbsp; &nbsp;&lt;!-- VexFlow Library for drawing music scores --&gt;<br> &nbsp; &nbsp;&lt;script src=&quot;https://unpkg.com/vexflow/build/vexflow.js&quot;&gt;&lt;/script&gt;<br> &nbsp; &nbsp;&lt;style&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;@import url(&#39;https://fonts.googleapis.com/css?family=Inter:wght@400;600;700;800&amp;display=swap&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp;body {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-family: &#39;Inter&#39;, sans-serif;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #230d1117;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #c9d1d9;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;#loading-message {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: fixed;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;top: 50%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;left: 50%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transform: translate(-50%,-50%);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z-index: 1000;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #161b22;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: white;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 2rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 0.75rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 4px 6px 1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0,0,0,0.06);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.5rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: bold;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.modal-overlay {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: fixed;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;top: 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;left: 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;width: 100%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;height: 100%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: rgba(0, 0, 0, 0.7);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;display: flex;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;justify-content: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;align-items: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z-index: 100;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.modal-content {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #3161b22;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #c9d1d9;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 2rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 1rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;max-width: 90%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;max-height: 90%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;overflow-y: auto;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: relative;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.modal-close {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: absolute;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;top: 1rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;right: 1rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 1.5rem;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cursor: pointer;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;/* Custom styles for the app */<br> &nbsp; &nbsp; &nbsp; &nbsp;.rounded-full {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 9999px;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.shadow-lg {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 10px 15px 3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.transform {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transform: scale(1);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.transition-all {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transition-property: all;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transition-duration: 300ms;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.duration-300 {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transition-duration: 300ms;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.hover\:scale-105:hover {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transform: scale(1.05);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.stave-container {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: relative;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.tutorial-highlight-overlay {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: fixed;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;top: 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;left: 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;width: 100%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;height: 100%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pointer-events: none;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transition: box-shadow 0.5s ease-in-out, top 0.5s ease-in-out, left 0.5s ease-in-out, width 0.5s ease-in-out, height 0.5s ease-in-out;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z-index: 99;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 0 0 0 transparent; /* Initial state, hidden */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-radius: 1rem; /* Rounded corners for the highlight */<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.pre-roll-message {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: absolute;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;top: 50%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;left: 50%;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transform: translate(-50%, -50%);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z-index: 10;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;display: flex;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;align-items: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;justify-content: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;flex-direction: column;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #10B981; /* emerald-400 */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 3rem; /* text-5xl */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: 800; /* font-extrabold */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;filter: drop-shadow(0 4px 3px rgb(0 0 0 / 0.07)) drop-shadow(0 2px 2px rgb(0 0 0 / 0.06)); /* drop-shadow-lg */<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.pre-roll-message-count {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-size: 5rem;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;.tutorial-step.active {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #10B981; /* emerald-400 */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: bold;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;&lt;/style&gt;<br>&lt;/head&gt;<br><br>&lt;body class=&quot;bg-zinc-900 text-white flex flex-col items-center p-4&quot;&gt;<br><br> &nbsp; &nbsp;&lt;!-- Loading message, visible while waiting for initialization --&gt;<br> &nbsp; &nbsp;&lt;div id=&quot;loading-message&quot;&gt;Cargando...&lt;/div&gt;<br><br> &nbsp; &nbsp;&lt;!-- Main content container --&gt;<br> &nbsp; &nbsp;&lt;div id=&quot;main-content&quot; class=&quot;hidden bg-zinc-800 rounded-2xl text-center border-2 shadow-2xl p-6 md:p-10 w-full max-w-4xl border-emerald-500&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;h1 class=&quot;text-4xl md:text-5xl font-extrabold text-emerald-400 mb-2 drop-shadow-md&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Lectura a Primera Vista<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/h1&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-zinc-500 text-sm mb-4&quot;&gt;Aplicaci&oacute;n realizada por Juan Miguel Rios Redondo&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-zinc-400 text-lg md:text-xl mb-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Ejercicios para guitarra<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/p&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Exercise Controls --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;controls-container&quot; class=&quot;flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4 mb-8&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;tempo-control&quot; class=&quot;flex items-center space-x-2&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label for=&quot;tempo&quot; class=&quot;text-zinc-300&quot;&gt;Tempo (BPM):&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;number&quot; id=&quot;tempo&quot; value=&quot;60&quot; min=&quot;1&quot; class=&quot;w-20 p-2 text-center rounded-lg bg-zinc-700 text-white border border-zinc-600 focus:outline-none focus:ring-2 focus:ring-emerald-500&quot;/&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;time-signature-control&quot; class=&quot;flex items-center space-x-2&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label for=&quot;time-signature-select&quot; class=&quot;text-zinc-300&quot;&gt;Comp&aacute;s:&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;select id=&quot;time-signature-select&quot; class=&quot;p-2 rounded-lg bg-zinc-700 text-white border border-zinc-600 focus:outline-none focus:ring-2 focus:ring-emerald-500&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;4/4&quot;&gt;4/4&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;3/4&quot;&gt;3/4&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;2/4&quot;&gt;2/4&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/select&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;difficulty-control&quot; class=&quot;flex items-center space-x-2&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label for=&quot;difficulty-select&quot; class=&quot;text-zinc-300&quot;&gt;Nivel:&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;select id=&quot;difficulty-select&quot; class=&quot;p-2 rounded-lg bg-zinc-700 text-white border border-zinc-600 focus:outline-none focus:ring-2 focus:ring-emerald-500&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;basico&quot;&gt;B&aacute;sico&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;medium&quot;&gt;Medio&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;advanced&quot;&gt;Avanzado&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/select&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;measures-control&quot; class=&quot;flex items-center space-x-2&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label for=&quot;measures-select&quot; class=&quot;text-zinc-300&quot;&gt;Compases por ejercicio: &lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;select id=&quot;measures-select&quot; class=&quot;p-2 rounded-lg bg-zinc-700 text-white border border-zinc-600 focus:outline-none focus:ring-2 focus:ring-emerald-500&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;5&quot;&gt;5&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;10&quot; selected&gt;10&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;15&quot;&gt;15&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;20&quot;&gt;20&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;custom&quot;&gt;Personalizado&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/select&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;custom-measures-input-container&quot; class=&quot;hidden&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;number&quot; id=&quot;custom-measures-input&quot; placeholder=&quot;Escribe un n&uacute;mero&quot; min=&quot;1&quot; class=&quot;w-32 p-2 text-center rounded-lg bg-zinc-700 text-white border border-zinc-600 focus:outline-none focus:ring-2 focus:ring-emerald-500&quot;/&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Option to choose when the measure changes --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;change-beat-control&quot; class=&quot;flex items-center justify-center space-x-2 mb-8&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label for=&quot;change-beat-select&quot; class=&quot;text-zinc-300&quot;&gt;Cambiar comp&aacute;s en el tiempo:&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;select id=&quot;change-beat-select&quot; class=&quot;p-2 rounded-lg bg-zinc-700 text-white border border-zinc-600 focus:outline-none focus:ring-2 focus:ring-emerald-500&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;4&quot; selected&gt;4&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/select&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Control Button and Show Tutorial Button --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;buttons-control&quot; class=&quot;flex justify-center space-x-4 mb-8&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;toggleButton&quot; class=&quot;bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Comenzar Ejercicio<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;show-tutorial&quot; class=&quot;bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Ver Tutorial<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Pentagrama View, always visible --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;bg-zinc-700 p-2 md:p-6 rounded-lg shadow-inner mb-8 overflow-x-auto w-full&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;stave-container&quot; class=&quot;stave-container w-full h-80 flex items-center justify-center bg-white rounded-lg shadow-md border border-zinc-600 overflow-x-hidden overflow-y-hidden&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Display Area, moved below the stave --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;displayArea&quot; class=&quot;hidden&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;bg-zinc-700 p-6 rounded-lg shadow-inner mb-8&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex justify-center items-center space-x-4 mb-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span class=&quot;text-zinc-300 font-mono&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Tiempo: &lt;span id=&quot;metronomeCount&quot; class=&quot;text-2xl font-bold ml-2 text-zinc-400&quot;&gt;0&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span class=&quot;text-zinc-300 font-mono&quot;&gt;Compases:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span id=&quot;measuresCount&quot; class=&quot;text-xl font-bold text-sky-400&quot;&gt;0 / 10&lt;/span&gt;&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- The new &quot;Preparaci&oacute;n&quot; message element --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;pre-roll-message&quot; class=&quot;pre-roll-message hidden&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&gt;Preparaci&oacute;n&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span id=&quot;preRollCount&quot; class=&quot;pre-roll-message-count&quot;&gt;&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp;&lt;!-- Tutorial Modal with interactive highlighting and a &quot;next&quot; button --&gt;<br> &nbsp; &nbsp;&lt;div id=&quot;tutorial-modal&quot; class=&quot;modal-overlay hidden&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;modal-content text-left max-w-sm&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span class=&quot;modal-close&quot; id=&quot;close-modal&quot;&gt;&times;&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-2xl sm:text-3xl font-bold mb-4 text-emerald-400&quot;&gt;Tutorial&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;tutorial-steps-container&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Tutorial steps will be dynamically inserted here --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;next-tutorial-step&quot; class=&quot;mt-4 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-full shadow-lg&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Siguiente<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp;&lt;!-- This overlay highlights the tutorial elements --&gt;<br> &nbsp; &nbsp;&lt;div id=&quot;tutorial-highlight-overlay&quot; class=&quot;tutorial-highlight-overlay hidden&quot;&gt;&lt;/div&gt;<br><br> &nbsp; &nbsp;&lt;script&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;// Global variables for elements to be accessible by all functions<br> &nbsp; &nbsp; &nbsp; &nbsp;let toggleButton, displayArea, tempoInput, metronomeCountSpan, staveContainer, mainContent, loadingMessage,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timeSignatureSelect, measuresSelect, measuresCountSpan, customMeasuresInputContainer, customMeasuresInput,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preRollMessage, difficultySelect, changeBeatSelect, showTutorialButton, tutorialModal, closeModalButton,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;controlsContainer, buttonsControl, tutorialHighlightOverlay, preRollCountSpan, nextTutorialStepButton;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;let exerciseStarted = false;<br> &nbsp; &nbsp; &nbsp; &nbsp;let metronomeTimer = null;<br> &nbsp; &nbsp; &nbsp; &nbsp;let exerciseMeasures = []; // Array to hold all pre-generated measures<br> &nbsp; &nbsp; &nbsp; &nbsp;let currentMeasureNotes = [];<br> &nbsp; &nbsp; &nbsp; &nbsp;let currentMetronomeCount = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp;let timeSignatureBeats = 4;<br> &nbsp; &nbsp; &nbsp; &nbsp;let measuresChangeBeat = 4; // The beat on which the measure changes<br> &nbsp; &nbsp; &nbsp; &nbsp;let currentMeasureIndex = -1; // New index to track progress through pre-generated measures<br> &nbsp; &nbsp; &nbsp; &nbsp;let measuresPerExercise = 10;<br> &nbsp; &nbsp; &nbsp; &nbsp;let isPreRoll = false;<br> &nbsp; &nbsp; &nbsp; &nbsp;let isPlaying = false;<br> &nbsp; &nbsp; &nbsp; &nbsp;let audioContext = null; // Initialize to null<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// Web Audio API scheduling variables<br> &nbsp; &nbsp; &nbsp; &nbsp;let lookahead = 25.0; // How far to look ahead (in milliseconds)<br> &nbsp; &nbsp; &nbsp; &nbsp;let scheduleAheadTime = 0.1; // How far ahead to schedule audio (in seconds)<br> &nbsp; &nbsp; &nbsp; &nbsp;let nextNoteTime = 0.0; // when the next note is due<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// Comprehensive list of all possible notes with a unique index for calculation.<br> &nbsp; &nbsp; &nbsp; &nbsp;// It strictly respects standard music theory:<br> &nbsp; &nbsp; &nbsp; &nbsp;// - No Fb, Cb, E#, or B# are included.<br> &nbsp; &nbsp; &nbsp; &nbsp;const allNotes = [<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;E/3&#39;, &#39;F/3&#39;, &#39;F#/3&#39;, &#39;Gb/3&#39;, &#39;G/3&#39;, &#39;G#/3&#39;, &#39;Ab/3&#39;, &#39;A/3&#39;, &#39;A#/3&#39;, &#39;Bb/3&#39;, &#39;B/3&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;C/4&#39;, &#39;C#/4&#39;, &#39;Db/4&#39;, &#39;D/4&#39;, &#39;D#/4&#39;, &#39;Eb/4&#39;, &#39;E/4&#39;, &#39;F/4&#39;, &#39;F#/4&#39;, &#39;Gb/4&#39;, &#39;G/4&#39;, &#39;G#/4&#39;, &#39;Ab/4&#39;, &#39;A/4&#39;, &#39;A#/4&#39;, &#39;Bb/4&#39;, &#39;B/4&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;C/5&#39;, &#39;C#/5&#39;, &#39;Db/5&#39;, &#39;D/5&#39;, &#39;D#/5&#39;, &#39;Eb/5&#39;, &#39;E/5&#39;, &#39;F/5&#39;, &#39;F#/5&#39;, &#39;Gb/5&#39;, &#39;G/5&#39;, &#39;G#/5&#39;, &#39;Ab/5&#39;, &#39;A/5&#39;, &#39;A#/5&#39;, &#39;Bb/5&#39;, &#39;B/5&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;C/6&#39;, &#39;C#/6&#39;, &#39;Db/6&#39;, &#39;D/6&#39;, &#39;D#/6&#39;, &#39;Eb/6&#39;, &#39;E/6&#39;<br> &nbsp; &nbsp; &nbsp; &nbsp;];<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;// Filtered notes for different difficulty levels<br> &nbsp; &nbsp; &nbsp; &nbsp;const naturalNotes = allNotes.filter(note =&gt; !note.includes(&#39;#&#39;) &amp;&amp; !note.includes(&#39;b&#39;));<br> &nbsp; &nbsp; &nbsp; &nbsp;// &#39;B&aacute;sico&#39; range is from E4 to E5<br> &nbsp; &nbsp; &nbsp; &nbsp;const basicNotes = naturalNotes.slice(naturalNotes.indexOf(&#39;E/4&#39;), naturalNotes.indexOf(&#39;E/5&#39;) + 1); <br> &nbsp; &nbsp; &nbsp; &nbsp;// &#39;Medio&#39; range is from E3 to A5<br> &nbsp; &nbsp; &nbsp; &nbsp;const mediumNotes = naturalNotes.slice(naturalNotes.indexOf(&#39;E/3&#39;), naturalNotes.indexOf(&#39;A/5&#39;) + 1);<br> &nbsp; &nbsp; &nbsp; &nbsp;const advancedNotes = allNotes;<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp;const noteToIndex = Object.fromEntries(allNotes.map((note, index) =&gt; [note, index]));<br> &nbsp; &nbsp; &nbsp; &nbsp;const indexToNote = allNotes;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// Clef and Note Position Data Structures<br> &nbsp; &nbsp; &nbsp; &nbsp;const clefData = {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;G&#39;: { // Treble Clef (G4)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;symbol: &#39;&#119070;&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noteYPosition: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;E/3&#39;: 115, &#39;F/3&#39;: 110, &#39;F#/3&#39;: 110, &#39;Gb/3&#39;: 110, &#39;G/3&#39;: 105, &#39;G#/3&#39;: 105, &#39;Ab/3&#39;: 105, &#39;A/3&#39;: 100, &#39;A#/3&#39;: 100, &#39;Bb/3&#39;: 100, &#39;B/3&#39;: 95,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;C/4&#39;: 90, &#39;C#/4&#39;: 90, &#39;Db/4&#39;: 90, &#39;D/4&#39;: 85, &#39;D#/4&#39;: 85, &#39;Eb/4&#39;: 85, &#39;E/4&#39;: 80, &#39;F/4&#39;: 75, &#39;F#/4&#39;: 75, &#39;Gb/4&#39;: 75, &#39;G/4&#39;: 70, &#39;G#/4&#39;: 70, &#39;Ab/4&#39;: 70, &#39;A/4&#39;: 65, &#39;A#/4&#39;: 65, &#39;Bb/4&#39;: 65, &#39;B/4&#39;: 60,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;C/5&#39;: 55, &#39;C#/5&#39;: 55, &#39;Db/5&#39;: 55, &#39;D/5&#39;: 50, &#39;D#/5&#39;: 50, &#39;Eb/5&#39;: 50, &#39;E/5&#39;: 45, &#39;F/5&#39;: 40, &#39;F#/5&#39;: 40, &#39;Gb/5&#39;: 40, &#39;G/5&#39;: 35, &#39;G#/5&#39;: 35, &#39;Ab/5&#39;: 35, &#39;A/5&#39;: 30, &#39;A#/5&#39;: 30, &#39;Bb/5&#39;: 30, &#39;B/5&#39;: 25,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;C/6&#39;: 20, &#39;C#/6&#39;: 20, &#39;Db/6&#39;: 20, &#39;D/6&#39;: 15, &#39;D#/6&#39;: 15, &#39;Eb/6&#39;: 15, &#39;E/6&#39;: 10<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// UI elements to highlight for the interactive tutorial<br> &nbsp; &nbsp; &nbsp; &nbsp;const tutorialSteps = [{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetId: &#39;tempo-control&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;text: &#39;Ajusta el &lt;strong class=&quot;text-emerald-400&quot;&gt;Tempo&lt;/strong&gt; del metr&oacute;nomo.&#39;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetId: &#39;time-signature-control&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;text: &#39;Selecciona el &lt;strong class=&quot;text-emerald-400&quot;&gt;Comp&aacute;s&lt;/strong&gt; deseado para el ejercicio.&#39;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetId: &#39;difficulty-control&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;text: &#39;Elige el &lt;strong class=&quot;text-emerald-400&quot;&gt;Nivel&lt;/strong&gt; de dificultad de las notas.&#39;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetId: &#39;difficulty-control&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;text: `El rango de notas para cada nivel es: &lt;br&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span class=&quot;font-bold text-emerald-400&quot;&gt;B&aacute;sico:&lt;/span&gt; De E4 a E5 &lt;br&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span class=&quot;font-bold text-emerald-400&quot;&gt;Medio:&lt;/span&gt; De E3 a A5 &lt;br&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span class=&quot;font-bold text-emerald-400&quot;&gt;Avanzado:&lt;/span&gt; De E3 a E6, incluyendo alteraciones.`<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetId: &#39;measures-control&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;text: &#39;Define la cantidad de &lt;strong class=&quot;text-emerald-400&quot;&gt;Compases por ejercicio&lt;/strong&gt;.&#39;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetId: &#39;change-beat-control&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;text: &#39;Elige en qu&eacute; &lt;strong class=&quot;text-emerald-400&quot;&gt;Tiempo&lt;/strong&gt; cambiar&aacute; de comp&aacute;s.&#39;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetId: &#39;toggleButton&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;text: &#39;Usa el bot&oacute;n &lt;strong class=&quot;text-emerald-400&quot;&gt;Comenzar/Detener Ejercicio&lt;/strong&gt; para iniciar o detener.&#39;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetId: &#39;stave-container&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;text: &#39;Observa la partitura en el &lt;strong class=&quot;text-emerald-400&quot;&gt;Pentagrama&lt;/strong&gt;. Un metr&oacute;nomo te guiar&aacute;.&#39;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;];<br><br> &nbsp; &nbsp; &nbsp; &nbsp;let currentTutorialStepIndex = 0;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/**<br> &nbsp; &nbsp; &nbsp; &nbsp; * Renders the current tutorial step in the modal.<br> &nbsp; &nbsp; &nbsp; &nbsp; */<br> &nbsp; &nbsp; &nbsp; &nbsp;const renderTutorialStep = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const tutorialStepsContainer = document.querySelector(&#39;.tutorial-steps-container&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (tutorialStepsContainer) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialStepsContainer.innerHTML = &#39;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const step = tutorialSteps[currentTutorialStepIndex];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const p = document.createElement(&#39;p&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;p.classList.add(&#39;text-base&#39;, &#39;sm:text-lg&#39;, &#39;mb-4&#39;, &#39;active&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;p.innerHTML = step.text;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialStepsContainer.appendChild(p);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Update next button text<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nextTutorialStepButton.textContent = (currentTutorialStepIndex &lt; tutorialSteps.length - 1) ? &#39;Siguiente&#39; : &#39;Cerrar&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Highlight the element<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;highlightTutorialStep(currentTutorialStepIndex);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/**<br> &nbsp; &nbsp; &nbsp; &nbsp; * Scrolls the page to make sure the target element is visible, then highlights it.<br> &nbsp; &nbsp; &nbsp; &nbsp; * @param {number} stepIndex The index of the tutorial step to highlight.<br> &nbsp; &nbsp; &nbsp; &nbsp; */<br> &nbsp; &nbsp; &nbsp; &nbsp;const highlightTutorialStep = (stepIndex) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const step = tutorialSteps[stepIndex];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const targetElement = document.getElementById(step.targetId);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (targetElement &amp;&amp; tutorialHighlightOverlay) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Scroll the element into view first<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetElement.scrollIntoView({ behavior: &#39;smooth&#39;, block: &#39;center&#39; });<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setTimeout(() =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const rect = targetElement.getBoundingClientRect();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialHighlightOverlay.style.top = `${rect.top + window.scrollY}px`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialHighlightOverlay.style.left = `${rect.left + window.scrollX}px`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialHighlightOverlay.style.width = `${rect.width}px`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialHighlightOverlay.style.height = `${rect.height}px`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialHighlightOverlay.style.boxShadow = &#39;0 0 0 9999px rgba(0, 0, 0, 0.7)&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialHighlightOverlay.classList.remove(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, 500); // 500ms delay to allow for the scroll animation to finish<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.error(`Tutorial target element with ID &quot;${step.targetId}&quot; not found.`);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/**<br> &nbsp; &nbsp; &nbsp; &nbsp; * Resets the tutorial highlighting and hides the overlay.<br> &nbsp; &nbsp; &nbsp; &nbsp; */<br> &nbsp; &nbsp; &nbsp; &nbsp;const resetTutorialHighlight = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (tutorialHighlightOverlay) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialHighlightOverlay.style.boxShadow = &#39;0 0 0 0 transparent&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialHighlightOverlay.classList.add(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/**<br> &nbsp; &nbsp; &nbsp; &nbsp; * Helper function to get the current clef&#39;s data<br> &nbsp; &nbsp; &nbsp; &nbsp; */<br> &nbsp; &nbsp; &nbsp; &nbsp;const getCurrentClefData = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return clefData[&#39;G&#39;];<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/**<br> &nbsp; &nbsp; &nbsp; &nbsp; * Plays a metronome click sound using the Web Audio API.<br> &nbsp; &nbsp; &nbsp; &nbsp; * @param {number} time The time (in seconds) to play the sound.<br> &nbsp; &nbsp; &nbsp; &nbsp; * @param {boolean} isAccent True if this beat is an accent.<br> &nbsp; &nbsp; &nbsp; &nbsp; */<br> &nbsp; &nbsp; &nbsp; &nbsp;function playMetronomeSound(time, isAccent) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!audioContext) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const oscillator = audioContext.createOscillator();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const gainNode = audioContext.createGain();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;oscillator.connect(gainNode);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gainNode.connect(audioContext.destination);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;oscillator.frequency.value = isAccent ? 880 : 440;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;oscillator.type = &#39;square&#39;;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gainNode.gain.setValueAtTime(isAccent ? 0.8 : 0.5, time);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;oscillator.start(time);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gainNode.gain.exponentialRampToValueAtTime(0.001, time + 0.05);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;oscillator.stop(time + 0.1);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/**<br> &nbsp; &nbsp; &nbsp; &nbsp; * Generates all notes for the entire exercise based on the &quot;grados conjuntos&quot; rule,<br> &nbsp; &nbsp; &nbsp; &nbsp; * with a maximum range from the starting note and all notes different from the previous.<br> &nbsp; &nbsp; &nbsp; &nbsp; *<br> &nbsp; &nbsp; &nbsp; &nbsp; * @returns {string[][]} An array of measures, where each measure is an array of notes.<br> &nbsp; &nbsp; &nbsp; &nbsp; */<br> &nbsp; &nbsp; &nbsp; &nbsp;const generateExercise = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const difficulty = difficultySelect.value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let noteRange;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;switch (difficulty) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case &#39;basico&#39;:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noteRange = basicNotes;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case &#39;medium&#39;:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noteRange = mediumNotes;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case &#39;advanced&#39;:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noteRange = advancedNotes;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const totalNotes = measuresPerExercise * timeSignatureBeats;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const allMeasures = [];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Function to get the note name without octave and accidental (e.g., &#39;D&#39;, &#39;E&#39;)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const getNoteName = (note) =&gt; note.split(&#39;/&#39;)[0].replace(/[#b]/g, &#39;&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let lastNote = noteRange[Math.floor(Math.random() * noteRange.length)];<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (let i = 0; i &lt; measuresPerExercise; i++) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const measure = [];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentNote;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// First note of each measure can be a leap (2nd, 3rd, or 4th)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (i === 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentNote = lastNote; // The first note of the entire exercise is a random pick<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let possibleNextNotes = [];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let lastNoteIndex = noteRange.indexOf(lastNote);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Allow leaps of up to a 4th<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (let j = 1; j &lt;= 4; j++) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (lastNoteIndex + j &lt; noteRange.length) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;possibleNextNotes.push(noteRange[lastNoteIndex + j]);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (lastNoteIndex - j &gt;= 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;possibleNextNotes.push(noteRange[lastNoteIndex - j]);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;do {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentNote = possibleNextNotes[Math.floor(Math.random() * possibleNextNotes.length)];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} while (currentNote === lastNote &amp;&amp; possibleNextNotes.length &gt; 1);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measure.push(currentNote);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentNoteIndex = noteRange.indexOf(currentNote);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// The rest of the notes in the measure are conjunct (2nd or 3rd)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (let j = 1; j &lt; timeSignatureBeats; j++) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let nextNote;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let possibleNextNotes = [];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (let k = 1; k &lt;= 2; k++) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentNoteIndex + k &lt; noteRange.length) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;possibleNextNotes.push(noteRange[currentNoteIndex + k]);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentNoteIndex - k &gt;= 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;possibleNextNotes.push(noteRange[currentNoteIndex - k]);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (possibleNextNotes.length === 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let validNotes = [...noteRange];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;do {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nextNote = validNotes[Math.floor(Math.random() * validNotes.length)];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} while (nextNote === currentNote &amp;&amp; validNotes.length &gt; 1);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;do {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nextNote = possibleNextNotes[Math.floor(Math.random() * possibleNextNotes.length)];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} while (nextNote === currentNote &amp;&amp; possibleNextNotes.length &gt; 1);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measure.push(nextNote);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentNote = nextNote;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentNoteIndex = noteRange.indexOf(currentNote);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;allMeasures.push(measure);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lastNote = measure[measure.length - 1]; // Set the last note of this measure for the next leap<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return allMeasures;<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp;/**<br> &nbsp; &nbsp; &nbsp; &nbsp; * Helper function to draw a single musical measure in an SVG group.<br> &nbsp; &nbsp; &nbsp; &nbsp; * @param {SVGElement} svg The parent SVG element.<br> &nbsp; &nbsp; &nbsp; &nbsp; * @param {string[]} notes The notes to draw.<br> &nbsp; &nbsp; &nbsp; &nbsp; * @param {number} xOffset The horizontal position of the measure.<br> &nbsp; &nbsp; &nbsp; &nbsp; * @param {number} measureWidth The width of the measure.<br> &nbsp; &nbsp; &nbsp; &nbsp; */<br> &nbsp; &nbsp; &nbsp; &nbsp;const drawMeasure = (svg, notes, xOffset, measureWidth) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const currentClefData = getCurrentClefData();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!currentClefData || !currentClefData.noteYPosition) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Datos de clave no definidos.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const noteYPosition = currentClefData.noteYPosition;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const timeSigParts = timeSignatureSelect.value.split(&#39;/&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const group = document.createElementNS(&quot;http://www.w3.org/2000/svg&quot;, &quot;g&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group.setAttribute(&#39;class&#39;, &#39;measure-group&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;svg.appendChild(group);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const staveTopY = 40;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const staveBottomY = 80;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (let i = 0; i &lt; 5; i++) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const yPos = staveTopY + i * 10;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const line = document.createElementNS(&quot;http://www.w3.org/2000/svg&quot;, &quot;line&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;line.setAttribute(&#39;x1&#39;, xOffset);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;line.setAttribute(&#39;y1&#39;, yPos);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;line.setAttribute(&#39;x2&#39;, xOffset + measureWidth);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;line.setAttribute(&#39;y2&#39;, yPos);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;line.setAttribute(&#39;stroke&#39;, &#39;#000000&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;line.setAttribute(&#39;stroke-width&#39;, &#39;1&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group.appendChild(line);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentX = xOffset + 20;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const clef = document.createElementNS(&quot;http://www.w3.org/2000/svg&quot;, &quot;text&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clef.setAttribute(&#39;x&#39;, currentX);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clef.setAttribute(&#39;y&#39;, 75); <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clef.setAttribute(&#39;font-family&#39;, &#39;sans-serif&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clef.setAttribute(&#39;font-size&#39;, &#39;40px&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clef.textContent = currentClefData.symbol;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group.appendChild(clef);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentX += 30;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const timeSigTop = document.createElementNS(&quot;http://www.w3.org/2000/svg&quot;, &quot;text&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timeSigTop.setAttribute(&#39;x&#39;, currentX);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timeSigTop.setAttribute(&#39;y&#39;, 60);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timeSigTop.setAttribute(&#39;font-size&#39;, &#39;18px&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timeSigTop.textContent = timeSigParts[0];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group.appendChild(timeSigTop);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const timeSigBottom = document.createElementNS(&quot;http://www.w3.org/2000/svg&quot;, &quot;text&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timeSigBottom.setAttribute(&#39;x&#39;, currentX);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timeSigBottom.setAttribute(&#39;y&#39;, 75);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timeSigBottom.setAttribute(&#39;font-size&#39;, &#39;18px&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timeSigBottom.textContent = timeSigParts[1];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group.appendChild(timeSigBottom);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentX += 30;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const notesStartMargin = currentX - xOffset;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const notesEndMargin = 20;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const availableNoteSpace = measureWidth - notesStartMargin - notesEndMargin;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const noteSpacing = notes.length &gt; 1 ? availableNoteSpace / (notes.length - 1) : 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const noteStartX = currentX + 10;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// New state to track altered notes within the current measure<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let alterationsInMeasure = {};<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;notes.forEach((note, index) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let yPosition = noteYPosition[note];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (yPosition === undefined) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(`Error: La nota &quot;${note}&quot; no tiene una posici&oacute;n Y definida para la clave de G.`);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const noteY = yPosition;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const noteX = noteStartX + index * noteSpacing;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const notePitch = note.split(&#39;/&#39;)[0].replace(/[#b]/g, &#39;&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const hasSharp = note.includes(&#39;#&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const hasFlat = note.includes(&#39;b&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const isNatural = !(hasSharp || hasFlat);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Determine which accidental to draw (if any)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let accidentalChar = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (hasSharp) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;accidentalChar = &#39;&#9839;&#39;; // Sharp sign<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alterationsInMeasure[notePitch] = &#39;sharp&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (hasFlat) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;accidentalChar = &#39;&#9837;&#39;; // Flat sign<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alterationsInMeasure[notePitch] = &#39;flat&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (isNatural &amp;&amp; (alterationsInMeasure[notePitch] === &#39;sharp&#39; || alterationsInMeasure[notePitch] === &#39;flat&#39;)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;accidentalChar = &#39;&#9838;&#39;; // Natural sign<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alterationsInMeasure[notePitch] = &#39;natural&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Draw the accidental if it exists<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (accidentalChar) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const accidentalElement = document.createElementNS(&quot;http://www.w3.org/2000/svg&quot;, &quot;text&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;accidentalElement.setAttribute(&#39;x&#39;, noteX - 28); // Adjusted x position to move it left<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;accidentalElement.setAttribute(&#39;y&#39;, noteY + 7);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;accidentalElement.setAttribute(&#39;font-family&#39;, &#39;sans-serif&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;accidentalElement.setAttribute(&#39;font-size&#39;, &#39;26px&#39;); // Increased font size<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;accidentalElement.textContent = accidentalChar;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group.appendChild(accidentalElement);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Draw the note head<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const noteHead = document.createElementNS(&quot;http://www.w3.org/2000/svg&quot;, &quot;ellipse&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noteHead.setAttribute(&#39;cx&#39;, noteX);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noteHead.setAttribute(&#39;cy&#39;, noteY);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noteHead.setAttribute(&#39;rx&#39;, &#39;6&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noteHead.setAttribute(&#39;ry&#39;, &#39;4.5&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noteHead.setAttribute(&#39;transform&#39;, `rotate(-15, ${noteX}, ${noteY})`);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noteHead.setAttribute(&#39;fill&#39;, &#39;#000000&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noteHead.setAttribute(&#39;class&#39;, &#39;note-head&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group.appendChild(noteHead);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Draw ledger lines if needed<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const ledgerLineLength = 20;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (noteY &lt; staveTopY) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentLedgerY = staveTopY;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;while (currentLedgerY &gt;= noteY) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const ledger = document.createElementNS(&quot;http://www.w3.org/2000/svg&quot;, &quot;line&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ledger.setAttribute(&#39;x1&#39;, noteX - ledgerLineLength / 2);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ledger.setAttribute(&#39;y1&#39;, currentLedgerY);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ledger.setAttribute(&#39;x2&#39;, noteX + ledgerLineLength / 2);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ledger.setAttribute(&#39;y2&#39;, currentLedgerY);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ledger.setAttribute(&#39;stroke&#39;, &#39;#000000&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ledger.setAttribute(&#39;stroke-width&#39;, &#39;1&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group.appendChild(ledger);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentLedgerY -= 10;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (noteY &gt; staveBottomY) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentLedgerY = staveBottomY;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;while (currentLedgerY &lt;= noteY) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const ledger = document.createElementNS(&quot;http://www.w3.org/2000/svg&quot;, &quot;line&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ledger.setAttribute(&#39;x1&#39;, noteX - ledgerLineLength / 2);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ledger.setAttribute(&#39;y1&#39;, currentLedgerY);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ledger.setAttribute(&#39;x2&#39;, noteX + ledgerLineLength / 2);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ledger.setAttribute(&#39;y2&#39;, currentLedgerY);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ledger.setAttribute(&#39;stroke&#39;, &#39;#000000&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ledger.setAttribute(&#39;stroke-width&#39;, &#39;1&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group.appendChild(ledger);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentLedgerY += 10;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/**<br> &nbsp; &nbsp; &nbsp; &nbsp; * Schedules the metronome beats and updates the visual display.<br> &nbsp; &nbsp; &nbsp; &nbsp; */<br> &nbsp; &nbsp; &nbsp; &nbsp;const scheduler = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!audioContext || !isPlaying) return;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;while (nextNoteTime &lt; audioContext.currentTime + scheduleAheadTime) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const tempo = parseInt(tempoInput.value, 10);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const beatDuration = 60.0 / tempo; // in seconds<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const isAccent = (currentMetronomeCount % timeSignatureBeats) === 0;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;playMetronomeSound(nextNoteTime, isAccent);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentMetronomeCount++;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentMetronomeCount &gt; timeSignatureBeats) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentMetronomeCount = 1;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isPreRoll) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preRollCountSpan.textContent = currentMetronomeCount;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentMetronomeCount === timeSignatureBeats) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isPreRoll = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preRollMessage.classList.add(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayArea.classList.remove(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;metronomeCountSpan.classList.add(&#39;text-emerald-400&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentMeasureIndex = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentMeasureNotes = exerciseMeasures[currentMeasureIndex];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresCountSpan.textContent = `${currentMeasureIndex + 1} / ${measuresPerExercise}`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentMetronomeCount === measuresChangeBeat) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentMeasureIndex++;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentMeasureIndex &lt; measuresPerExercise) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentMeasureNotes = exerciseMeasures[currentMeasureIndex];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresCountSpan.textContent = `${currentMeasureIndex + 1} / ${measuresPerExercise}`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopExercise();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;metronomeCountSpan.textContent = currentMetronomeCount;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderStave();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nextNoteTime += beatDuration;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;metronomeTimer = window.setTimeout(scheduler, lookahead);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/**<br> &nbsp; &nbsp; &nbsp; &nbsp; * Stops the current exercise and resets the state.<br> &nbsp; &nbsp; &nbsp; &nbsp; */<br> &nbsp; &nbsp; &nbsp; &nbsp;const stopExercise = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!exerciseStarted) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;exerciseStarted = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isPlaying = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;toggleButton.textContent = &#39;Comenzar Ejercicio&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayArea.classList.add(&#39;hidden&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (metronomeTimer) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clearTimeout(metronomeTimer);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;metronomeTimer = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentMeasureIndex = -1;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isPreRoll = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentMetronomeCount = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentMeasureNotes = [];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const measuresValue = measuresSelect.value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresPerExercise = measuresValue === &#39;custom&#39; ?<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;parseInt(customMeasuresInput.value, 10) : parseInt(measuresValue, 10);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresCountSpan.textContent = `0 / ${measuresPerExercise}`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;metronomeCountSpan.textContent = &quot;0&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preRollMessage.classList.add(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderStave();<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/**<br> &nbsp; &nbsp; &nbsp; &nbsp; * Renders the musical stave with the current measure.<br> &nbsp; &nbsp; &nbsp; &nbsp; */<br> &nbsp; &nbsp; &nbsp; &nbsp;function renderStave() {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;staveContainer.innerHTML = &#39;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const svg = document.createElementNS(&quot;http://www.w3.org/2000/svg&quot;, &quot;svg&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const measureWidth = 300;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const staveWidth = measureWidth + 60;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const staveHeight = 200;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;svg.setAttribute(&#39;viewBox&#39;, `0 0 ${staveWidth} ${staveHeight}`);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;svg.setAttribute(&#39;width&#39;, &#39;100%&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;svg.setAttribute(&#39;height&#39;, &#39;100%&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;staveContainer.appendChild(svg);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const currentMeasureX = 30;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isPreRoll &amp;&amp; exerciseMeasures.length &gt; 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;drawMeasure(svg, exerciseMeasures[0], currentMeasureX, measureWidth);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (!isPreRoll &amp;&amp; exerciseStarted) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentMeasureNotes &amp;&amp; currentMeasureNotes.length &gt; 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;drawMeasure(svg, currentMeasureNotes, currentMeasureX, measureWidth);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;drawMeasure(svg, [], currentMeasureX, measureWidth);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;drawMeasure(svg, [], currentMeasureX, measureWidth);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/**<br> &nbsp; &nbsp; &nbsp; &nbsp; * Starts the metronome and exercise.<br> &nbsp; &nbsp; &nbsp; &nbsp; */<br> &nbsp; &nbsp; &nbsp; &nbsp;const startMetronome = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!audioContext) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;audioContext = new (window.AudioContext || window.webkitAudioContext)();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (audioContext.state === &#39;suspended&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await audioContext.resume();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const measuresValue = measuresSelect.value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const numMeasures = measuresValue === &#39;custom&#39; ?<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;parseInt(customMeasuresInput.value, 10) : parseInt(measuresValue, 10);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isNaN(numMeasures) || numMeasures &lt;= 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;El n&uacute;mero de compases no es v&aacute;lido.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopExercise();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresPerExercise = numMeasures;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;exerciseMeasures = generateExercise();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (exerciseMeasures.length === 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error: No se pudieron generar las notas para el ejercicio. Por favor, revisa la configuraci&oacute;n.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopExercise();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;exerciseStarted = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isPlaying = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isPreRoll = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentMetronomeCount = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preRollMessage.classList.remove(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayArea.classList.add(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;metronomeCountSpan.classList.remove(&#39;text-emerald-400&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;toggleButton.textContent = &#39;Detener Ejercicio&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nextNoteTime = audioContext.currentTime + 1.0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;scheduler();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderStave();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (e) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error al iniciar el ejercicio:&quot;, e);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopExercise();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;/**<br> &nbsp; &nbsp; &nbsp; &nbsp; * Initializes the application by getting elements, setting up event listeners.<br> &nbsp; &nbsp; &nbsp; &nbsp; */<br> &nbsp; &nbsp; &nbsp; &nbsp;function initializeApp() {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const getElement = (id) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const el = document.getElementById(id);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!el) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(`Error: Elemento con ID &quot;${id}&quot; no encontrado.`);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;throw new Error(`Element with ID &quot;${id}&quot; not found.`);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return el;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;toggleButton = getElement(&#39;toggleButton&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayArea = getElement(&#39;displayArea&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tempoInput = getElement(&#39;tempo&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;metronomeCountSpan = getElement(&#39;metronomeCount&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;staveContainer = getElement(&#39;stave-container&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mainContent = getElement(&#39;main-content&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;loadingMessage = getElement(&#39;loading-message&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timeSignatureSelect = getElement(&#39;time-signature-select&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresSelect = getElement(&#39;measures-select&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresCountSpan = getElement(&#39;measuresCount&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;customMeasuresInputContainer = getElement(&#39;custom-measures-input-container&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;customMeasuresInput = getElement(&#39;custom-measures-input&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preRollMessage = getElement(&#39;pre-roll-message&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;difficultySelect = getElement(&#39;difficulty-select&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;changeBeatSelect = getElement(&#39;change-beat-select&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showTutorialButton = getElement(&#39;show-tutorial&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialModal = getElement(&#39;tutorial-modal&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;closeModalButton = getElement(&#39;close-modal&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;controlsContainer = getElement(&#39;controls-container&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buttonsControl = getElement(&#39;buttons-control&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialHighlightOverlay = getElement(&#39;tutorial-highlight-overlay&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preRollCountSpan = getElement(&#39;preRollCount&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nextTutorialStepButton = getElement(&#39;next-tutorial-step&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;loadingMessage.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mainContent.classList.remove(&#39;hidden&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const measuresValue = measuresSelect.value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresPerExercise = measuresValue === &#39;custom&#39; ? 10 : parseInt(measuresValue, 10);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresCountSpan.textContent = `0 / ${measuresPerExercise}`;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Event Listeners<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresSelect.addEventListener(&#39;change&#39;, () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (measuresSelect.value === &#39;custom&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;customMeasuresInputContainer.classList.remove(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresPerExercise = parseInt(customMeasuresInput.value, 10) || 10;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;customMeasuresInputContainer.classList.add(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresPerExercise = parseInt(measuresSelect.value, 10);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresCountSpan.textContent = `0 / ${measuresPerExercise}`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;customMeasuresInput.addEventListener(&#39;input&#39;, () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const customValue = parseInt(customMeasuresInput.value, 10);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresPerExercise = isNaN(customValue) || customValue &lt;= 0 ? 10 : customValue;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresCountSpan.textContent = `0 / ${measuresPerExercise}`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;toggleButton.addEventListener(&#39;click&#39;, () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (exerciseStarted) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopExercise();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;startMetronome();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;difficultySelect.addEventListener(&#39;change&#39;, () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (exerciseStarted) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopExercise();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderStave();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timeSignatureSelect.addEventListener(&#39;change&#39;, () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const timeSigParts = timeSignatureSelect.value.split(&#39;/&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;timeSignatureBeats = parseInt(timeSigParts[0], 10);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;changeBeatSelect.innerHTML = &#39;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (let i = 1; i &lt;= timeSignatureBeats; i++) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const option = document.createElement(&#39;option&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;option.value = i;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;option.textContent = i;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;changeBeatSelect.appendChild(option);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;changeBeatSelect.value = timeSignatureBeats;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresChangeBeat = parseInt(changeBeatSelect.value, 10);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (exerciseStarted) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopExercise();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderStave();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;changeBeatSelect.addEventListener(&#39;change&#39;, () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;measuresChangeBeat = parseInt(changeBeatSelect.value, 10);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (exerciseStarted) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopExercise();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderStave();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showTutorialButton.addEventListener(&#39;click&#39;, () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialModal.classList.remove(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentTutorialStepIndex = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderTutorialStep();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;closeModalButton.addEventListener(&#39;click&#39;, () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialModal.classList.add(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resetTutorialHighlight();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialModal.addEventListener(&#39;click&#39;, (event) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (event.target === tutorialModal) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialModal.classList.add(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resetTutorialHighlight();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nextTutorialStepButton.addEventListener(&#39;click&#39;, () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentTutorialStepIndex++;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentTutorialStepIndex &lt; tutorialSteps.length) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderTutorialStep();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tutorialModal.classList.add(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resetTutorialHighlight();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderStave();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (e) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&#39;Fatal error during application initialization:&#39;, e);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;window.onload = initializeApp;<br> &nbsp; &nbsp;&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></span></p></body></html>